<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>정현88님과 koLOVE님의 게임</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 30px; }
    #coords { font-size: 1.5em; margin-bottom: 20px; }

     /* ========== 그리드와 채팅을 나란히 배치하기 위한 컨테이너 추가 ========== */
    #mainContainer {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 30px;
      margin: 50px auto;
      max-width: 1000px;
    }
    /* ========== 컨테이너 추가 끝 ========== */

    /* ========== 그리드 컨테이너 추가 (바둑판 라인을 그리기 위함) ========== */
    #gridWrapper {
      position: relative;
      width: 450px;
      height: 450px;
      border: 8px solid #36454F;
      background-color: #DEB887; /* 바둑판 배경색 */
    }
    /* ========== 그리드 컨테이너 끝 ========== */

    /* 그리드 스타일 */
    #grid {
      position: relative; /* z-index를 위해 추가 */
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      grid-template-rows: repeat(9, 1fr);
      gap: 0; /* ========== gap을 0으로 변경 ========== */
      justify-content: center;
      /* ========== border 제거 (gridWrapper로 이동) ========== */
      /* border: 8px solid #36454F; */
      width: 450px;
      height: 450px;
      box-sizing: border-box;
      z-index: 2; /* 돌이 라인 위에 오도록 */
    }

    .cell {
      background-color: transparent; /* ========== 투명하게 변경 ========== */
      /* ========== 셀 테두리 숨김 (border를 transparent로) ========== */
      border: 1px solid transparent;
      /* ========== 셀 테두리 숨김 끝 ========== */
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative; /* z-index를 위해 추가 */
    }

    .active {
      background-color: transparent;
      color: inherit;
      font-weight: bold;
      z-index: 3; /* 돌이 가장 위에 오도록 */
    }

    /* ========== 바둑판 라인 그리기 시작 ========== */
    /* 가로 라인 (9개) */
    .horizontal-line {
      position: absolute;
      left: 25px; /* 셀 너비의 절반 (450px / 9 / 2 = 25px) */
      right: 25px;
      height: 2px;
      background-color: #000;
      z-index: 1;
    }

    /* 세로 라인 (9개) */
    .vertical-line {
      position: absolute;
      top: 25px;
      bottom: 25px;
      width: 2px;
      background-color: #000;
      z-index: 1;
    }
    /* ========== 바둑판 라인 그리기 끝 ========== */

    #chatContainer {
      width: 350px;
      text-align: left;
    }

    #chatBox {
      border: 2px solid #36454F;
      height: 370px;
      overflow-y: auto;
      padding: 10px;
      background-color: #f9f9f9;
      margin-bottom: 10px;
    }

    .chatMessage {
      margin: 5px 0;
      color: #333;
    }

    #chatInputContainer {
      display: flex;
      gap: 10px;
    }

    #chatInput {
      flex: 1;
      padding: 8px;
      border: 2px solid #36454F;
      font-size: 14px;
    }

    #sendButton {
      padding: 8px 20px;
      background-color: #36454F;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    #sendButton:hover {
      background-color: #4a5a6a;
    }
  </style>
</head>
<body>
  <h1>정현88님과 koLOVE님의 게임</h1>

  <!-- ========== 그리드와 채팅을 감싸는 컨테이너 추가 ========== -->
  <div id="mainContainer">
    <!-- ========== gridWrapper 추가 (바둑판 라인을 담기 위함) ========== -->
    <div id="gridWrapper">
      <div id="grid"></div>
    </div>
    <!-- ========== gridWrapper 끝 ========== -->

  <div id="chatContainer">
    <div id="chatBox"></div>
    <div id="chatInputContainer">
      <input type="text" id="chatInput" placeholder="메시지를 입력하세요..." />
      <button id="sendButton">전송</button>
    </div>
  </div>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const gridWrapper = document.getElementById("gridWrapper"); // ========== gridWrapper 참조 추가 ==========
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");
    const sendButton = document.getElementById("sendButton");
    const ROOM_ID = "game1";

    // 9x9 셀 생성
    for (let y = 0; y < 9; y++) {
      for (let x = 0; x < 9; x++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.x = x;
        cell.dataset.y = y;
        grid.appendChild(cell);
      }
    }

    // ========== 바둑판 라인 그리기 시작 ==========
    // 가로 라인 9개 생성 (각 줄의 중앙)
    for (let i = 0; i < 9; i++) {
      const hLine = document.createElement("div");
      hLine.classList.add("horizontal-line");
      hLine.style.top = `${25 + i * 50}px`; // 25px + (셀 높이 50px * 인덱스)
      gridWrapper.appendChild(hLine);
    }

    // 세로 라인 9개 생성 (각 열의 중앙)
    for (let i = 0; i < 9; i++) {
      const vLine = document.createElement("div");
      vLine.classList.add("vertical-line");
      vLine.style.left = `${25 + i * 50}px`; // 25px + (셀 너비 50px * 인덱스)
      gridWrapper.appendChild(vLine);
    }
    // ========== 바둑판 라인 그리기 끝 ==========

    // WebSocket 연결
    const ws = new WebSocket("ws://localhost:6789");
    ws.onopen = function() {
      // ========== 연결되면 바로 방 정보 전송 ==========
      ws.send(JSON.stringify({ room: ROOM_ID }));
      console.log(`Joined room: ${ROOM_ID}`);
      // ========== 방 정보 전송 끝 ==========
    };


    ws.onmessage = function(event) {
      const data = JSON.parse(event.data);
      // ========== 다른 방의 메시지는 무시 ==========
      if (data.room && data.room !== ROOM_ID) {
        return;
      }
      const b_x = data.b_x;
      const b_y = data.b_y;
      const w_x = data.w_x;
      const w_y = data.w_y;

    if (data.reset) {
    document.querySelectorAll(".cell").forEach(cell => {
      cell.textContent = "";
      cell.classList.remove("active");
    });
    console.log("보드 초기화됨");
    return;
  }

  if (data.b_x !== undefined && data.b_y !== undefined) {
        const target_b = document.querySelector(`.cell[data-x='${b_x}'][data-y='${b_y}']`);
        if (target_b) {
            target_b.classList.add("active");
            target_b.textContent = "⚫️";
        }
    }
  if (data.w_x !== undefined && data.w_y !== undefined) {
        setTimeout(() => {
            const target_w = document.querySelector(`.cell[data-x='${w_x}'][data-y='${w_y}']`)

            if (target_w) {
                target_w.classList.add("active");
                target_w.textContent = "⚪";
            }

         },500);
  }
    };

    ws.onerror = function() {
      const coordsElement = document.getElementById("coords");
      if (coordsElement) {
        coordsElement.textContent = "연결 오류!";
      }
    };

    // 채팅 메시지 추가 함수
    function addMessage(message) {
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("chatMessage");
      messageDiv.textContent = `: ${message}`;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // 전송 버튼 클릭 이벤트
    sendButton.addEventListener("click", function() {
      const message = chatInput.value.trim();
      if (message) {
        addMessage(message);
        chatInput.value = "";
      }
    });

    // Enter 키로 전송
    chatInput.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        const message = chatInput.value.trim();
        if (message) {
          addMessage(message);
          chatInput.value = "";
        }
      }
    });
  </script>
</body>
</html>
